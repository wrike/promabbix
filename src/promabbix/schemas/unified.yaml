title: Alert Configuration Schema
description: JSON Schema for unified YAML alert configuration format combining alerts, zabbix, and wiki sections
type: object
required:
  - groups
  - zabbix
additionalProperties: false
properties:
  groups:
    type: array
    minItems: 1
    maxItems: 2
    items:
      type: object
      required:
        - name
        - rules
      additionalProperties: false
      properties:
        name:
          type: string
          enum:
            - recording_rules
            - alerting_rules
          description: 'Group type: recording_rules for Prometheus queries, alerting_rules for Zabbix triggers'
        rules:
          type: array
          items:
            oneOf:
              - type: object
                required:
                  - record
                  - expr
                additionalProperties: false
                properties:
                  record:
                    type: string
                    minLength: 3
                    maxLength: 160
                    pattern: ^[a-zA-Z][a-zA-Z0-9_:]*$
                    description: Unique recording rule name, used as metric name
                  expr:
                    type: string
                    minLength: 1
                    description: PromQL expression to evaluate
                  labels:
                    type: object
                    additionalProperties:
                      type: string
                    description: Additional labels to attach to the metric
              - type: object
                required:
                  - alert
                  - expr
                additionalProperties: false
                properties:
                  alert:
                    type: string
                    minLength: 3
                    maxLength: 160
                    pattern: ^[a-zA-Z][a-zA-Z0-9_:]*$
                    description: Alert name, should reference a recording rule
                  expr:
                    type: string
                    minLength: 1
                    description: Zabbix trigger expression
                  for:
                    type: string
                    pattern: ^\d+[smhd]$
                    description: Duration the expression must be true before firing (e.g., 5m, 1h)
                  labels:
                    type: object
                    additionalProperties:
                      type: string
                    properties:
                      __zbx_priority:
                        type: string
                        enum:
                          - INFO
                          - WARNING
                          - AVERAGE
                          - HIGH
                          - DISASTER
                        description: Zabbix trigger severity level
                  annotations:
                    type: object
                    additionalProperties: false
                    properties:
                      description:
                        type: string
                        description: Detailed alert description with label templating
                      summary:
                        type: string
                        description: Brief alert summary
                    required:
                      - summary
  prometheus:
    type: object
    additionalProperties: false
    properties:
      api:
        type: object
        required:
          - url
        properties:
          url:
            type: string
            format: uri
            description: Prometheus/VictoriaMetrics API endpoint
      labels_to_zabbix_macros:
        type: array
        items:
          type: object
          required:
            - pattern
            - value
          properties:
            pattern:
              type: string
              description: Regex pattern to match in alert templates
            value:
              type: string
              description: Zabbix macro replacement value
      query_chars_encoding:
        type: array
        items:
          type: object
          required:
            - char
            - encode
          properties:
            char:
              type: string
              maxLength: 1
            encode:
              type: string
  promabbix:
    type: object
    additionalProperties: false
    properties:
      zabbix_depend_item_preprocessing:
        type: string
        description: JSONPath expression for dependent item preprocessing
      zabbix_master_item_preprocessing:
        type: string
        description: JavaScript code for master item preprocessing
  zabbix:
    type: object
    additionalProperties: false
    properties:
      template:
        type: string
        description: Zabbix template name
      name:
        type: string
        description: Human-readable template name
      labels:
        type: object
        additionalProperties:
          type: string
      lld_filters:
        type: object
        required:
          - filter
        additionalProperties: false
        properties:
          filter:
            type: object
            required:
              - conditions
              - evaltype
            additionalProperties: false
            properties:
              conditions:
                type: array
                minItems: 1
                items:
                  type: object
                  required:
                    - formulaid
                    - macro
                    - value
                  additionalProperties: false
                  properties:
                    formulaid:
                      type: string
                      pattern: ^[A-Z]$
                      description: Single uppercase letter A-Z
                    macro:
                      type: string
                      pattern: ^\{#[A-Z0-9_]+\}$
                      description: LLD macro like {#LABEL_NAME}
                    value:
                      type: string
                      description: Regex pattern or macro reference
                    operator:
                      type: string
              evaltype:
                type: string
                enum:
                  - AND
                  - OR
                description: How to combine multiple conditions
      macros:
        type: array
        items:
          type: object
          required:
            - macro
            - value
          additionalProperties: false
          properties:
            macro:
              type: string
              description: Zabbix macro like {$THRESHOLD} or {$THRESHOLD:"context"}
            value:
              type: [string, number]
              description: Macro value
            description:
              type: string
              description: Human-readable macro description
      tags:
        type: array
        items:
          type: object
          required:
            - tag
            - value
          additionalProperties: false
          properties:
            tag:
              type: string
              minLength: 1
              description: Tag name
            value:
              type: string
              description: Tag value
      hosts:
        type: array
        items:
          type: object
          required:
            - host_name
            - visible_name
            - host_groups
            - link_templates
          additionalProperties: false
          properties:
            host_name:
              type: string
              pattern: ^[a-zA-Z0-9._-]+$
              description: Zabbix host name
            visible_name:
              type: string
              minLength: 1
              description: Human-readable host name
            host_groups:
              type: array
              items:
                type: string
                minLength: 1
              description: List of Zabbix host groups
            link_templates:
              type: array
              items:
                type: string
              description: List of template names to link to this host
            status:
              type: string
              enum:
                - enabled
                - disabled
              default: enabled
              description: Host monitoring status
            state:
              type: string
              enum:
                - present
                - absent
              default: present
              description: Whether host should exist or be removed
            proxy:
              type: [string, "null"]
              description: Zabbix proxy name or null for direct monitoring
            macros:
              type: array
              items:
                type: object
                required:
                  - macro
                  - value
                additionalProperties: false
                properties:
                  macro:
                    type: string
                    description: Zabbix macro like {$THRESHOLD} or {$THRESHOLD:"context"}
                  value:
                    type: [string, number]
                    description: Macro value
                  description:
                    type: string
                    description: Human-readable macro description
              description: Host-specific macro overrides
  wiki:
    type: object
    additionalProperties: false
    properties:
      templates:
        type: object
        additionalProperties: false
        properties:
          wrike_alert_config:
            type: object
            properties:
              templates:
                type: array
                items:
                  type: object
                  required:
                    - name
                    - title
                  additionalProperties: false
                  properties:
                    name:
                      type: string
                      minLength: 1
                      description: Template identifier
                    title:
                      type: string
                      minLength: 1
                      description: Template display title
      knowledgebase:
        type: object
        additionalProperties: false
        properties:
          alerts:
            type: object
            additionalProperties: false
            properties:
              alertings:
                type: object
                patternProperties:
                  ^[a-zA-Z][a-zA-Z0-9_:]*$:
                    type: object
                    required:
                      - title
                      - content
                    additionalProperties: false
                    properties:
                      title:
                        type: string
                        minLength: 1
                        description: Alert documentation title
                      content:
                        type: string
                        minLength: 1
                        description: Alert documentation content
                additionalProperties: false
                description: Documentation for each alert rule by alert name
